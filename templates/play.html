{% extends "layout.html" %}

{% block head %}
<title>Play - Sudoku Lounge</title>
<link href="/static/play.css" rel="stylesheet">   
{% endblock %}
  
{% block content %}
<div class="container">
    
    <div class="sudoku">
        <!-- Difficulty Selection -->
        <div class="difficulty-section">
            Difficulty:
            <nav>
                <a href="/play">Easy</a>
                <a href="/play">Medium</a>
                <a href="/play">Hard</a>
                <a href="/play">Expert</a>
                <a href="/play">Master</a>
            </nav>
        </div>
        
        <!-- Sudoku Board using table -->
        <table id="sudokuBoard" class="sudoku-board">
            {% for row in range(9) %}
            <tr>
                {% for col in range(9) %}
                <td data-row="{{ row }}" data-col="{{ col }}" class="cell {% if (row // 3 + col // 3) % 2 == 0 %}grouped{% endif %}">
                    {% if board[row][col] != 0 %}
                        {{ board[row][col] }}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Controls Section -->
    <div class="controls">
        <!-- Game Stats -->
        <div class="stats">
            <div>Mistakes: 0/3</div><div>Score: 0</div><div>00:00</div>
        </div>
        <!-- Action buttons -->
        <div class="buttons">
            <button>Undo</button><button>Erase</button><button>Notes</button><button>Hint</button>
        </div>

        <!-- Numpad (1-9) -->
        <div class="numpad">
            <button>1</button><button>2</button><button>3</button>
            <button>4</button><button>5</button><button>6</button>
            <button>7</button><button>8</button><button>9</button>
        </div>

        <!-- New Game button -->
        <div class="new-game">
            New Game
        </div>
    </div>
</div>

<script>
    let selectedCell = null;

    // Handle cell click
    document.querySelectorAll('.cell').forEach(cell => {
        cell.addEventListener('click', function() {
            document.querySelectorAll('.cell').forEach(c => {
                c.classList.remove('selected');
                c.classList.remove('highlight');
            });
            this.classList.add('selected');
            selectedCell = this;

            // Get row and column of the selected cell
            const selectedRow = parseInt(this.dataset.row);
            const selectedCol = parseInt(this.dataset.col);

            // Highlight the row, column, and 3x3 grid
            highlightRowColGrid(selectedRow, selectedCol);
        });
    });

    // Highlight the row, column, and 3x3 grid
    function highlightRowColGrid(row, col) {
        const cells = document.querySelectorAll('.cell');

        // Highlight the row and column
        cells.forEach(cell => {
            const cellRow = parseInt(cell.dataset.row);
            const cellCol = parseInt(cell.dataset.col);

            if (cellRow === row || cellCol === col) {
                cell.classList.add('highlight');
            }

            // Highlight the 3x3 grid
            const startRow = Math.floor(row / 3) * 3;
            const startCol = Math.floor(col / 3) * 3;

            if (cellRow >= startRow && cellRow < startRow + 3 && cellCol >= startCol && cellCol < startCol + 3) {
                cell.classList.add('highlight');
            }
        });
    }

    // Handle numpad button click to fill the cell
    document.querySelectorAll('.numpad button').forEach(button => {
        button.addEventListener('click', function() {
            const num = parseInt(this.innerText);
            if (selectedCell) {
                selectedCell.innerText = num;

                // Send the move to the server
                const row = selectedCell.dataset.row;
                const col = selectedCell.dataset.col;

                fetch('/submit_move', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        row: row,
                        col: col,
                        value: num
                    })
                }).then(response => response.json())
                  .then(data => {
                      if (!data.success) {
                          alert('Invalid move');
                      }
                  });
            }
        });
    });
</script>
{% endblock %}